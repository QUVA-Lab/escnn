<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Practical Notes on Steerable Dense Convolution &mdash; escnn 1.0.7 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script>window.MathJax = {"TeX": {"Macros": {"bold": ["{\\bf #1}", 1], "R": "{\\mathbb R}", "N": "{\\mathbb N}", "Z": "{\\mathbb Z}", "Ind": ["{\\operatorname{Ind}_{#1}^{#2}}", 2], "Res": ["{\\operatorname{Res}_{#1}^{#2}}", 2], "GL": ["{\\operatorname{GL}(#1)}", 1], "E": ["{\\operatorname{E}(#1)}", 1], "SE": ["{\\operatorname{SE}(#1)}", 1], "O": ["{\\operatorname{O}(#1)}", 1], "SO": ["{\\operatorname{SO}(#1)}", 1], "U": ["{\\operatorname{U}(#1)}", 1], "D": ["{\\operatorname{D}_{#1}}", 1], "C": ["{\\operatorname{C}_{#1}}", 1], "DN": "{\\operatorname{D}_{\\!N}}", "CN": "{\\operatorname{C}_{\\!N}}"}}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> escnn
          </a>
              <div class="version">
                1.0.7
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Package Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="escnn.group.html">escnn.group</a><ul>
<li class="toctree-l2"><a class="reference internal" href="escnn.group.html#factory-functions">Factory Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.group.html#group">Group</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.group.html#groupelement">GroupElement</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.group.html#groups">Groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.group.html#homogeneous-space">Homogeneous Space</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.group.html#representations">Representations</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.group.html#utility-functions">Utility Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.group.html#subpackages">Subpackages</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="escnn.kernels.html">escnn.kernels</a><ul>
<li class="toctree-l2"><a class="reference internal" href="escnn.kernels.html#generic-kernel-bases">Generic Kernel Bases</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.kernels.html#general-steerable-basis-for-equivariant-kernels">General Steerable Basis for equivariant kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.kernels.html#steerable-filter-bases">Steerable Filter Bases</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.kernels.html#generic-group-acting-on-a-single-point">Generic Group acting on a single point</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.kernels.html#bases-for-group-actions-on-the-plane">Bases for Group Actions on the Plane</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.kernels.html#bases-for-group-actions-in-3d-space">Bases for Group Actions in 3D Space</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="escnn.gspaces.html">escnn.gspaces</a><ul>
<li class="toctree-l2"><a class="reference internal" href="escnn.gspaces.html#factory-methods">Factory Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.gspaces.html#abstract-group-space">Abstract Group Space</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.gspaces.html#group-action-trivial-on-single-point">Group Action (trivial) on single point</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.gspaces.html#group-actions-on-the-plane">Group Actions on the Plane</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.gspaces.html#group-actions-on-the-3d-space">Group Actions on the 3D Space</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="escnn.nn.html">escnn.nn</a><ul>
<li class="toctree-l2"><a class="reference internal" href="escnn.nn.html#field-type">Field Type</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.nn.html#geometric-tensor">Geometric Tensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.nn.html#equivariant-module">Equivariant Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.nn.html#utils">Utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.nn.html#linear-layers">Linear Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.nn.html#steerable-dense-convolution">Steerable Dense Convolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.nn.html#steerable-point-convolution">Steerable Point Convolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.nn.html#basismanager">BasisManager</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.nn.html#non-linearities">Non Linearities</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.nn.html#invariant-maps">Invariant Maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.nn.html#pooling">Pooling</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.nn.html#normalization">Normalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.nn.html#dropout">Dropout</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.nn.html#other-modules">Other Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="escnn.nn.html#module-escnn.nn.init">Weight Initialization</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">escnn</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Practical Notes on Steerable Dense Convolution</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/api/rdconv_practical.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="practical-notes-on-steerable-dense-convolution">
<span id="conv-practical-notes"></span><h1>Practical Notes on Steerable Dense Convolution<a class="headerlink" href="#practical-notes-on-steerable-dense-convolution" title="Permalink to this headline"></a></h1>
<p>In this section, we include a few notes and practical tips for using
<a class="reference internal" href="escnn.nn.html#steerable-dense-conv"><span class="std std-ref">discretized convolution layers</span></a>.</p>
<p>These modules implement <strong>discretized convolution</strong> operators over discrete grids.
This means that <strong>equivariance</strong> to continuous symmetries is <strong>not perfect</strong>.
In practice, by using sufficiently band-limited filters, the equivariance error introduced by the
discretization of the filters and the features is contained, but some design choices may have a negative
effect on the overall equivariance of the architecture.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#data-augmentation-to-prevent-propagation-of-equivariance-error" id="id2">Data augmentation to prevent propagation of equivariance error</a></p></li>
<li><p><a class="reference internal" href="#downsampling-can-break-equivariance-to-the-exact-symmetries-of-the-grid" id="id3">Downsampling can break equivariance to the exact symmetries of the grid</a></p></li>
<li><p><a class="reference internal" href="#default-steerable-basis" id="id4">Default steerable basis</a></p></li>
<li><p><a class="reference internal" href="#even-sized-filters-and-kernel-size-2" id="id5">Even-sized filters and <code class="docutils literal notranslate"><span class="pre">kernel_size=2</span></code></a></p></li>
</ul>
</div>
<section id="data-augmentation-to-prevent-propagation-of-equivariance-error">
<h2><a class="toc-backref" href="#contents">Data augmentation to prevent propagation of equivariance error</a><a class="headerlink" href="#data-augmentation-to-prevent-propagation-of-equivariance-error" title="Permalink to this headline"></a></h2>
<p>Unfortunately, the small equivariance error can be leveraged during optimization to break the equivariance in case the
training data does not present the chosen symmetry.
For this reason, <strong>we recommend to use data augmentation</strong> when training models equivariant to continuous symmetries on
discretized data.</p>
</section>
<section id="downsampling-can-break-equivariance-to-the-exact-symmetries-of-the-grid">
<h2><a class="toc-backref" href="#contents">Downsampling can break equivariance to the exact symmetries of the grid</a><a class="headerlink" href="#downsampling-can-break-equivariance-to-the-exact-symmetries-of-the-grid" title="Permalink to this headline"></a></h2>
<p>If the architecture involves <strong>downsampling</strong> of intermediate features (e.g. via <em>strided convolution</em>),
some design choices <strong>may also break the equivariance</strong> to the discrete symmetries of the grid.
For instance, using odd-sized convolutional filters with <code class="docutils literal notranslate"><span class="pre">stride=2</span></code> over an even-sized image will break the
equivariance to the 90 degrees rotations of the input, see Figure 2 <a class="reference external" href="https://arxiv.org/abs/2004.09691">here</a> for
more details.
We recommend working with <em>odd-sized images/features</em> in such cases.</p>
</section>
<section id="default-steerable-basis">
<h2><a class="toc-backref" href="#contents">Default steerable basis</a><a class="headerlink" href="#default-steerable-basis" title="Permalink to this headline"></a></h2>
<p>The parameters <code class="docutils literal notranslate"><span class="pre">sigma</span></code>, <code class="docutils literal notranslate"><span class="pre">frequencies_cutoff</span></code> and <code class="docutils literal notranslate"><span class="pre">rings</span></code> of
<a class="reference internal" href="escnn.nn.html#escnn.nn.modules.conv._RdConv" title="escnn.nn.modules.conv._RdConv"><code class="xref py py-class docutils literal notranslate"><span class="pre">_RdConv</span></code></a> (and its subclasses like <code class="xref py py-class docutils literal notranslate"><span class="pre">R2Conv</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">R3Conv</span></code>) are optional
parameters used to control how the basis for the steerable filters is built, how it is sampled on the filter
grid and how it is expanded to build the filter.
These <strong>default values</strong> work well in most cases since we tuned them manually in a few practical settings
(odd-sized filters, with relatively small kernel size), so we don’t recommend changing them.
In case you may want to adapt them for different use cases (e.g. even-sized or really wide filters), we provide
more details about them below.</p>
<p>The default steerable basis used by the convolution layers is built by using <a class="reference internal" href="escnn.kernels.html#escnn.kernels.CircularShellsBasis" title="escnn.kernels.CircularShellsBasis"><code class="xref py py-class docutils literal notranslate"><span class="pre">CircularShellsBasis</span></code></a>
or <a class="reference internal" href="escnn.kernels.html#escnn.kernels.SphericalShellsBasis" title="escnn.kernels.SphericalShellsBasis"><code class="xref py py-class docutils literal notranslate"><span class="pre">SphericalShellsBasis</span></code></a> so steerable filters are in general split in multiple rings,
see Figure 2 <a class="reference external" href="https://arxiv.org/pdf/1711.07289.pdf">here</a> .</p>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">rings</span></code> is a list of float values, defining the radius of the different rings the filter is split into.
The parameter <code class="docutils literal notranslate"><span class="pre">sigma</span></code> defines the width of each of them.
You can pass a list containing a different sigma per radius or just a singular float value which is used for all rings.
The parameter <code class="docutils literal notranslate"><span class="pre">frequencies_cutoff</span></code> regulates the maximum frequency on each ring.
By default, it uses a policy we manually tuned.
If you pass a float value <code class="docutils literal notranslate"><span class="pre">frequencies_cutoff=F</span></code>, the maximum frequency at radius <code class="docutils literal notranslate"><span class="pre">r</span></code> becomes <code class="docutils literal notranslate"><span class="pre">int(r</span> <span class="pre">*</span> <span class="pre">F)</span></code>.
Alternative, you can pass a generic function accepting a radius <code class="docutils literal notranslate"><span class="pre">r</span></code> in input and return the maximum frequency
accepted at that radius.</p>
</section>
<section id="even-sized-filters-and-kernel-size-2">
<h2><a class="toc-backref" href="#contents">Even-sized filters and <code class="docutils literal notranslate"><span class="pre">kernel_size=2</span></code></a><a class="headerlink" href="#even-sized-filters-and-kernel-size-2" title="Permalink to this headline"></a></h2>
<p>While even-sized convolutional filters (<code class="docutils literal notranslate"><span class="pre">kernel_size</span></code> is an even number) are supported,
they are generally less stable to continuous rotations.
This is partially because the default parameters of the steerable basis were manually tuned for odd-sized filters.
In particular, if <code class="docutils literal notranslate"><span class="pre">kernel_size=2</span></code>, the resulting grid is too small to sample any filter in the constructed
steerable basis: as a result, the sampled basis is empty and an error is raised.
<strong>We don’t recommend using this grid</strong> if your goal is achieving equivariance to all rotations.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">kernel_size=2</span></code> filter can be useful if you only care about equivariance to <span class="math notranslate nohighlight">\(90\deg\)</span> rotations.
In that case, you can play with the <cite>sigma</cite>,  <cite>rings</cite> and <cite>frequencies_cutoff</cite> parameters of
<code class="xref py py-class docutils literal notranslate"><span class="pre">R2Conv</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">R3Conv</span></code> to build a non-empty basis.
By tuning these parameters, you might be able to get a basis stable enough to continuous rotations for
your application, but we didn’t experiment with this setting enough to provide any recommendation.
You can find a useful discussion about this in <a class="reference external" href="https://github.com/QUVA-Lab/e2cnn/issues/18">this issue</a> .</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Qualcomm Innovation Center, Inc. Developed by Gabriele Cesa.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>